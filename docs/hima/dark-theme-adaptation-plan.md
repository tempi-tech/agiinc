# ダークテーマ適応計画 — デモ GIF 1-A / 1-B

> Creative Director レア・デュボワ | 2026-02-16 | ステータス: 確定

---

## 0. 背景と目的

Session 18 の実UIテストキャプチャで、`hima.agiinc.io/app` がダークテーマ（`#0F172A` 系ダークネイビー基調）であることが判明した。現行 Remotion モックはオフホワイト `#FAFAF8` 基調のため、実UI映像への差し替え時にシーン全体の色調整が必要となる。

本文書は、Remotion のテキストオーバーレイ・トランジション演出・カーソル表現におけるダークテーマ対応方針を確定し、シーンごとの演出ノートを定義する。

---

## 1. 方針: フル置換 + オーバーレイ色調整

### 1-1. 基本方針

**実UI映像のフル置換**を採用する。ハイブリッド（モック+実UI混在）は採用しない。

理由:
- 実UIのダークテーマとモックのライトテーマを混在させると視覚的統一感が損なわれる
- `real-ui-capture-readiness-report.md` の結論と一致: フル置換が最適解
- エンドフレーム（`SceneEndFrame`）はチャコール `#1A1A1A` 背景のため、ダークテーマの実UIとの接続が自然

### 1-2. 調整が必要な要素

実UI映像をそのまま埋め込むため、**UI自体の色調整は不要**。ただし以下の Remotion 側の演出要素は調整が必要:

| 要素 | 現行（ライトテーマ前提） | 調整後（ダークテーマ対応） | 理由 |
|---|---|---|---|
| **トランジション背景** | 不透明フェード（白→白） | ダークフェード対応 | フェード中間で白が一瞬出るのを防ぐ |
| **カーソルハイライト** | `rgba(45,58,140,0.22)` | `rgba(99,132,255,0.30)` | ダーク背景ではインディゴ系が沈むため、明るいブルーで視認性確保 |
| **カーソル本体** | Fill `#1A1A1A` / Stroke `#FFFFFF` | Fill `#FFFFFF` / Stroke `#0F172A` | 暗背景で黒カーソルが見えないため反転 |
| **クリックハイライト** | `rgba(45,58,140,0.15)` | Kap ネイティブ機能に委譲 | 実UI録画に含まれるため Remotion 側は無効化 |

### 1-3. 調整が不要な要素

| 要素 | 理由 |
|---|---|
| **エンドフレーム** | 背景 `#1A1A1A` / テキスト `#FFFFFF` で、ダークテーマからの遷移が自然。変更不要 |
| **シーン内のUI描画** | 実UI映像で完全置換するため、`HimaWorkspace` モックの色パレットは使用しない |
| **フォント設定** | Inter + Noto Sans JP + JetBrains Mono の構成は維持。フォント色はUI映像内に含まれる |

---

## 2. カラーパレット対照表

### 2-1. Remotion BRAND 定数の変更

実UI映像フル置換により、シーン内のモック描画はなくなる。BRAND 定数は**エンドフレームとトランジション周りでのみ使用**される。

| 定数名 | 現行値 | 変更後の値 | 用途 |
|---|---|---|---|
| `offWhite` | `#FAFAF8` | **削除対象** | モック背景 → 実UI置換で不使用 |
| `charcoal` | `#1A1A1A` | `#1A1A1A`（維持） | エンドフレーム背景 |
| `indigo` | `#2D3A8C` | `#2D3A8C`（維持） | ブランドカラー。ボタン等は実UIに含まれる |
| `teal` | `#0D9488` | `#0D9488`（維持） | 進捗バー等は実UIに含まれる |
| `warmGray` | `#F0EEEB` | **削除対象** | モック二次背景 → 不使用 |
| `border` | `#E5E7EB` | **削除対象** | モックボーダー → 不使用 |
| `textSecondary` | `#6B7280` | **削除対象** | モック二次テキスト → 不使用 |

**新規追加:**

| 定数名 | 値 | 用途 |
|---|---|---|
| `darkNavy` | `#0F172A` | 実UIベース背景色。トランジション制御に使用 |
| `darkPanel` | `#1E293B` | 実UIパネル背景色。参照値 |
| `cursorLight` | `#FFFFFF` | ダーク背景用カーソル本体色 |
| `highlightBlue` | `rgba(99,132,255,0.30)` | ダーク背景用カーソルハイライト |

### 2-2. 実UIとモックの色差異まとめ

| 要素 | モック | 実UI | 差異レベル |
|---|---|---|---|
| 背景 | `#FAFAF8` | `#0F172A` | 極大（白→紺） |
| テキスト | `#1A1A1A` | `#FFFFFF` / ライトグレー | 極大（黒→白） |
| パネル | `#FFFFFF` | `#1E293B` | 極大 |
| ボタン | `#2D3A8C` | ブルー系（共通） | 小 |
| アクセント（Teal） | `#0D9488` | `#0D9488` 相当 | なし |
| レイアウト | 2カラム | 2カラム + 下部結果 | 中（構造差） |

---

## 3. シーン別ダークテーマ演出ノート

### 3-0. 共通ルール

- **トランジション**: `fade()` のクロスフェードは実UI映像間で直接行う。中間フレームで白背景が出ないよう、TransitionSeries の背景色を `#0F172A` に設定
- **カーソル演出**: 実UI録画にカーソルが含まれるため、Remotion 側のカーソルオーバーレイ（`cursorPosition` / `showCursorHighlight` / カーソル SVG）はすべて無効化
- **テキストオーバーレイ**: シーン内に Remotion 側で追加するテキスト注釈は現行仕様にないため調整不要。将来的に追加する場合は白テキスト + ドロップシャドウ `0 1px 3px rgba(0,0,0,0.6)` を使用

---

### 3-1. S0: ワークスペース全景（1-B のみ、0:00 — 0:02）

| 項目 | 変更内容 |
|---|---|
| 映像ソース | `assets/real-ui/s0-overview.webm`（実UI静止ショット） |
| 背景色 | 映像が画面全体を覆うため指定不要。コンテナ背景は `#0F172A` |
| テキスト色 | オーバーレイなし |
| カーソル | 画面中央に静止。Kap 録画のカーソルをそのまま使用 |
| トランジション（→S1） | `fade()` 0.33s。背景 `#0F172A` |

**調整不要**: 静止ショットのため色調整は発生しない。

---

### 3-2. S1: レシピ作成（1-A: 0:00-0:04 / 1-B: 0:02-0:08）

| 項目 | 変更内容 |
|---|---|
| 映像ソース | `assets/real-ui/s1-recipe.webm` |
| 背景色 | コンテナ: `#0F172A` |
| Remotion モック描画 | **全削除**: `HimaWorkspace` の `promptText`, `variablesDetected`, `cursorPosition`, `showCursorHighlight` 描画ブロックを実UI映像に完全置換 |
| タイプライター演出 | Remotion 側のタイプライター合成は無効。実UIでの入力操作を直接録画 |
| 変数検出表示 | 実UIのリアルタイム検出をそのまま収録 |
| カーソル | Kap 録画に含まれる。Remotion カーソルオーバーレイ無効 |
| トランジション（→S2） | `fade()` 0.3s（1-A）/ 0.33s（1-B）。背景 `#0F172A` |

**ダークテーマ影響**: 実UIでは入力フィールドがダーク背景に白テキストのため、タイプ中の文字視認性はモックより良好。変数検出のハイライト（Teal 系）もダーク背景で目立つ。

---

### 3-3. S2: CSV 読み込み + マッピング（1-A: 0:04-0:09 / 1-B: 0:08-0:14）

| 項目 | 変更内容 |
|---|---|
| 映像ソース | `assets/real-ui/s2-csv-import.webm` |
| 背景色 | コンテナ: `#0F172A` |
| Remotion モック描画 | **全削除**: `csvLoaded`, `mappings`, `cursor*`, `csvPreviewData` のモック描画を実UI映像で置換 |
| ドラッグ演出 | Remotion 側の CSV アイコン合成・ドラッグパス描画は無効。実操作を直接録画 |
| ドロップゾーン色変化 | 実UIのハイライト表示（ボーダー色変化）がそのまま収録される |
| カーソル | Kap 録画。Remotion 側無効 |
| トランジション（→S3） | `fade()` 0.3s / 0.33s。背景 `#0F172A` |

**ダークテーマ影響**: ドロップゾーンのハイライト（ボーダーがインディゴに変化）はダーク背景でコントラストが高く、モックより視覚的に明確。マッピング UI のドロップダウンもダーク背景で白テキストのため可読性良好。

---

### 3-4. S3: バッチ実行（1-A: 0:09-0:15 / 1-B: 0:14-0:22）

| 項目 | 変更内容 |
|---|---|
| 映像ソース | `assets/real-ui/s3-batch-exec.webm` |
| 背景色 | コンテナ: `#0F172A` |
| Remotion モック描画 | **全削除**: `batchProgress` 系の合成ロジック（進捗バー、完了件数表示、行ステータス更新）を実UI映像で置換 |
| 進捗バー色 | 実UIの進捗バーを使用。Teal `#0D9488` 系のアクセント色はダーク背景で高コントラスト |
| ステータスアイコン | 実UIの「処理中」「完了」表示をそのまま収録 |
| カーソル | Kap 録画。Remotion 側無効 |
| トランジション（→S4） | `fade()` 0.3s / 0.33s。背景 `#0F172A` |

**ダークテーマ影響**: 進捗バーの Teal グリーン (`#0D9488`) がダーク背景で非常に映える。完了時のバー色変化もコントラストが高い。モックより視覚的インパクトが強い。

---

### 3-5. S4: 結果エクスポート（1-A: 0:15-0:18 / 1-B: 0:22-0:28）

| 項目 | 変更内容 |
|---|---|
| 映像ソース | `assets/real-ui/s4-export.webm` |
| 背景色 | コンテナ: `#0F172A` |
| Remotion モック描画 | **全削除**: `expandedRow`, `showExportDone`, `results`, `csv mapping` 周りの HimaWorkspace 生成を実UI映像で置換 |
| 行展開アニメ | 実UIの展開動作を録画。CMO 提案の「スライドアニメーション追加」は実UIの動作確認後に判断 |
| フォントサイズ | CMO 提案「テーブル最小 12px」: 撮影時に 1.1-1.2 倍拡大で収録し、リサイズ後も 12px 相当を維持 |
| エクスポート完了表示 | 実UIのトースト通知をそのまま収録 |
| カーソル | Kap 録画。Remotion 側無効 |
| トランジション（→End / →S1 ループ） | 1-A: `fade()` 0.3s → S1 ループ先頭。背景 `#0F172A`。1-B: `fade()` 0.5s → エンドフレーム |

**ダークテーマ影響**: 結果テーブルの行展開時、白テキスト on ダーク背景で生成文の可読性が高い。エクスポート完了のトースト通知もダーク背景で目立つ。

**CMO レビュー対応:**
- テーブル最小フォント 12px: 撮影時のズーム率で対応。ダーク背景での白テキストはライトテーマより小サイズでも可読性が高い傾向があり、12px 維持は問題なし
- S4 行展開スライドアニメ: 実UIの展開動作を確認し、即時展開の場合は Kap 録画を 30fps で撮り、ffmpeg での速度調整で自然なスライド感を演出。Remotion 側での補間トランジション追加は不要になる見込み

---

### 3-6. エンドフレーム（1-B のみ、0:28 — 0:30）

| 項目 | 変更内容 |
|---|---|
| 背景色 | `#1A1A1A`（チャコール）— **変更なし** |
| テキスト | `hima.agiinc.io` Inter Bold 24px 白 `#FFFFFF` — **変更なし** |
| サブテキスト | `無料・登録不要・BYOK` Inter Regular 14px 白 `#FFFFFF` — **変更なし** |
| トランジション（S4 → End） | `fade()` 0.5s。ダークテーマ→チャコールの遷移は自然 |

**ダークテーマ影響**: ダークネイビー `#0F172A` → チャコール `#1A1A1A` のフェード遷移は、明度差がわずか（両方暗色）のため非常に滑らか。モック（オフホワイト→チャコール）よりも自然な接続になる。これはダークテーマ移行の副次的メリット。

---

## 4. トランジション演出の詳細

### 4-1. クロスフェード背景色の変更

現行の `TransitionSeries` は背景色の明示的指定がなく、デフォルト（透明→白）でフェードしている。ダークテーマではフェード中間に白フラッシュが発生するリスクがある。

**対応:**

シーンコンテナの `style.backgroundColor` を `#0F172A` に統一する。

```tsx
// 各シーンのルートコンテナに適用
<AbsoluteFill style={{ backgroundColor: "#0F172A" }}>
  <Video src={staticFile(`real-ui/${shotName}.webm`)} />
</AbsoluteFill>
```

### 4-2. トランジションタイミング（変更なし）

| バージョン | フェード秒数 | フレーム数 | 変更 |
|---|---|---|---|
| 1-A（LP） | 0.5s | 7-8 frames @ 15fps | なし |
| 1-B（X） | 0.33s | 4 frames @ 12fps | なし |
| 1-B End | 0.5s | 6 frames @ 12fps | なし |

### 4-3. ループ接続（1-A）

1-A は S4 末尾→S1 先頭でループする。両方ダークテーマの実UI映像のため、ループ接続のフェードも自然。

---

## 5. 撮影時の注意事項（ダークテーマ固有）

### 5-1. コントラスト・可読性

- ダーク背景でのテキスト可読性: 白テキスト on ダーク背景は一般的にライトテーマよりコントラスト比が高い。GIF 圧縮後もテキストが潰れにくい
- ただし、微細なグレーテキスト（placeholder や secondary text）は GIF 256 色パレットで失われやすい。`palettegen` の `max_colors=256` + `floyd_steinberg` ディザリングで対応

### 5-2. ffmpeg パレット最適化

ダークテーマは色域が狭い（暗色中心）ため、GIF パレットの利用効率が高い。

- `stats_mode=diff`（フレーム間差分ベース）は維持。ダーク背景の大面積が共通パレットを消費しにくい
- ファイルサイズは**ライトテーマより小さくなる見込み**。暗色領域はフレーム間差分が少なく、GIF 圧縮効率が高い
- テスト結果（静止画）で 1-A が 7.3MB だった問題は、実操作録画では大幅に改善される見込み（ダークテーマの広い暗色面積が圧縮に有利）

### 5-3. 画面の明るさ設定

- 撮影時のディスプレイ輝度: 80% 以上を推奨。Kap のキャプチャはピクセル値ベースのため輝度は影響しないが、操作の正確性のため
- Chrome のダークモード強制（`prefers-color-scheme`）: hima.agiinc.io が自前でダークテーマを実装しているため、ブラウザ側のダークモード設定は影響なし

---

## 6. 実装タスク一覧

| # | タスク | ファイル | 変更内容 | 優先度 |
|---|---|---|---|---|
| 1 | BRAND 定数にダークテーマ色を追加 | `types.ts` / `DemoGifLP.tsx` / `DemoGifX.tsx` | `darkNavy`, `darkPanel`, `cursorLight`, `highlightBlue` を追加 | P1 |
| 2 | シーンコンテナ背景色を `#0F172A` に変更 | 全シーンコンポーネント | ルート `AbsoluteFill` の `backgroundColor` を設定 | P1 |
| 3 | カーソルオーバーレイ無効化フラグ追加 | `HimaWorkspace.tsx` | `realUiShot` prop が指定されたとき、カーソル描画を無効化 | P1 |
| 4 | 実UI映像読み込みコンポーネント実装 | 各シーン `Scene*.tsx` | `realUiShot` prop で `<Video>` or `<Img>` に切り替え | P2 |
| 5 | トランジション背景色の統一 | `DemoGifLP.tsx` / `DemoGifX.tsx` | TransitionSeries 周りのコンテナ背景を `#0F172A` に | P2 |
| 6 | 不要な BRAND 定数の削除 | `types.ts` | `offWhite`, `warmGray`, `border`, `textSecondary` を削除（Phase 2 完了後） | P3 |

---

## 7. 品質ゲート

ダークテーマ適応後の品質基準:

| # | チェック項目 | 基準 | 確認方法 |
|---|---|---|---|
| 1 | トランジション中の白フラッシュ | 発生しないこと | Remotion プレビューで全トランジションを目視 |
| 2 | テキスト可読性（11-12px） | GIF 再生時に判読可能 | 1-A / 1-B 出力を実寸で確認 |
| 3 | カーソル視認性 | ダーク背景で明確に見えること | Kap 録画プレビューで確認 |
| 4 | エンドフレーム遷移 | ダークネイビー → チャコールが自然 | Remotion プレビュー |
| 5 | ループ接続（1-A） | S4→S1 のフェードが自然 | GIF 出力でループ再生確認 |
| 6 | ファイルサイズ | 1-A: 5MB 以下 / 1-B: 15MB 以下 | `ls -lh` |
| 7 | 色バンディング | ダーク部分でバンディングなし | GIF 出力を目視確認 |

---

## 8. まとめ

- **方針**: 実UI映像のフル置換。モック+実UIのハイブリッドは不採用
- **Remotion 側の調整**: トランジション背景色の変更（`#0F172A`）とカーソルオーバーレイ無効化のみ。大規模な色調整は不要
- **ダークテーマのメリット**: GIF 圧縮効率向上、テキスト可読性向上、エンドフレームとの自然な接続
- **リスク**: フェード中間の白フラッシュ（対策済み）、微細グレーテキストの GIF 圧縮劣化（ディザリングで対応）
- **結論**: ダークテーマへの移行はデモ GIF の品質を総合的に**向上**させる。ライトテーマ前提で設計された演出の大部分は、実UI映像フル置換により自然に解消される
